var Calc=function(){this.parser=Parser,this.consoleOutput=!1,this.answers=[],this.expressionStates=[],this.complete=!1,this.currentOperatorPosition=null,this.selectedPart="",this.currentAnswer="",this.firstBracket="NotSet",this.lastBracket="NotSet",this.firstPoint="NotSet",this.lastPoint="NotSet",this.operator="NotSet",this.gotNegative=!1};Calc.prototype={init:function(expression,consoleOutput){this.consoleOutput=consoleOutput||!1,this.expression=expression,this.answers=[],this.expressionStates=[],this.complete=!1,this.currentOperatorPosition=null,this.expressionStates.push(this.expression)},calculateStep:function(){if(this.selectedPart="",this.currentAnswer="",this.firstBracket="NotSet",this.lastBracket="NotSet",this.firstPoint="NotSet",this.lastPoint="NotSet",this.operator="NotSet",this.gotNegative=!1,this.selectedPart=this.expression,-1!=(this.firstBracket=this.expression.indexOf("("))){for(this.lastBracket=this.expression.indexOf(")"),this.selectedPart=this.expression.slice(this.firstBracket,this.lastBracket+1);this.firstBracket<this.selectedPart.indexOf("(",this.firstBracket+1);)this.firstBracket++;this.selectedPart=this.expression.slice(this.firstBracket,this.lastBracket+1)}if(-1!=this.selectedPart.indexOf("*")||-1!=this.selectedPart.indexOf("/"))this.findPart(!0);else if(-1!=this.selectedPart.indexOf("+")||-1!=this.selectedPart.indexOf("-"))this.findPart(!1);else if(-1==this.firstBracket)return void(this.complete=!0);"NotSet"!=this.firstPoint?this.gotNegative?(this.selectedPart=this.selectedPart.slice(this.firstPoint-1,this.lastPoint+1),this.gotNegative=!1):this.selectedPart=this.selectedPart.slice(this.firstPoint,this.lastPoint+1):(this.expressionStates.pop(),this.answers.pop()),this.currentAnswer=this.parser.evaluate(this.selectedPart),this.expression=this.expression.replace(this.selectedPart,this.currentAnswer),-1!=this.expression.search("("+this.currentAnswer+")")&&(this.expression=this.expression.replace("("+this.currentAnswer+")",this.currentAnswer)),this.answers.push(this.currentAnswer),this.expressionStates.push(this.expression),this.output()},findPart:function(gotMultOrDiv){for(var i=0;i<this.selectedPart.length;i++)if("("!=this.selectedPart[i]&&")"!=this.selectedPart[i])if(isNaN(parseInt(this.selectedPart[i]))&&"."!=this.selectedPart[i]){if("NotSet"!=this.operator)break;if(gotMultOrDiv&&("+"==this.selectedPart[i]||"-"==this.selectedPart[i])){this.firstPoint="NotSet";continue}if("-"==this.selectedPart[i]&&("("==this.selectedPart[i-1]||void 0===this.selectedPart[i-1])){if(this.expression==this.selectedPart&&-1==this.selectedPart.indexOf("-",i+1)&&-1==this.selectedPart.indexOf("+",i+1)){this.complete=!0;break}this.gotNegative=!0;continue}this.operator=this.selectedPart[i],this.currentOperatorPosition=i,this.firstBracket>0&&(this.currentOperatorPosition+=this.firstBracket)}else"NotSet"==this.firstPoint?this.firstPoint=i:this.lastPoint=i},solve:function(){for(;!this.complete;)this.calculateStep()},output:function(){this.consoleOutput&&(console.log("Answer: "+this.currentAnswer),console.log("Expression after: "+this.expression),console.log("All results: "+this.expressionStates),console.log("All answers: "+this.answers),console.log("********************"))}};